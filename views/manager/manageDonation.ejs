<!DOCTYPE html>
<html>

<head>
    <title>Manage Donations</title>
    <!-- Link to Bootstrap CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            /* Updated font family to 'Poppins' */

        }

        /* Additional custom styles for the page */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }


        .navbar .navbar-brand,
        .navbar .nav-link {
            color: #fff;
            font-family: 'Roboto Slab', serif, ;
            font-weight: bold;
            font-size: 16px;
            margin-top: 15px;
        }

        body {
            padding-top: 0px;
            margin-bottom: 60px;
        }

        .jumbotron {
            background-color: #3498db;
            color: #fff;
            margin-bottom: 0;
        }

        .navbar {
            background-color: #219ebc;
            padding: 10px 0;
        }

        nav ul {
            list-style: none;
            text-align: center;
        }

        nav ul li {
            display: inline-block;
        }

        nav ul li a {
            display: block;
            padding: 15px;
            text-decoration: none;
            color: #aaa;
            font-weight: 800;
            text-transform: uppercase;
            margin: 0 10px;
            position: relative;
            transition: all .5s;
        }

        nav ul li a:hover {
            color: #555;
        }

        nav ul li a::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #8ecae6;
            transform: scaleX(0);
            transition: transform 0.5s;
        }

        nav ul li a:hover::after {
            transform: scaleX(1);
        }

        /* Custom Logout Button Style */
        .btn-logout {
            background-color: #002244;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            transition: background-color 0.3s;
            margin-right: 20px;
            font-weight: bold;
            color: white;
            font-family: 'Roboto Slab', serif, ;

        }

        .btn-logout:hover {
            background-color: #6082B6;
            color: #fff;
            text-decoration: none;
        }

            
        .navbar-toggler {
            border: none;
            margin-right: auto;
        }
    
        .navbar-toggler-icon {
            display: inline-block;
            width: 30px;
            height: 30px;
            vertical-align: middle;
            background-image: none;
            
        }
    
        .navbar-toggler-icon:after,
        .navbar-toggler-icon:before,
        .navbar-toggler-icon div {
            content: '';
            display: block;
            height: 3px;
            margin: 5px 0;
            background-color: #fff; /* Change color if needed */
        }
        .navbar-light .navbar-toggler-icon {
            background-color: #219ebc;
          }   

        /* status modal header */
        #statusModalLabel {
            text-align: center;
            display: block;
            width: 100%;
        }

        .modal-header {
            background-color: #4B9CD3;
            color: #fff;
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
        }

        .table-wrapper {
            position: relative;
            width: 100%;
        }

        .table-custom {
            width: 150%;
            border-collapse: collapse;
            margin-top: 60px;
            margin-left: -150px;
        }

        .table-custom th,
        .table-custom td {
            padding: 15px 20px;
            border: 1px solid #dee2e6;
            text-align: left;
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            color: #212529;
        }

        /* Zebra striping for rows */
        .table-custom tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        /* Hover effect for rows (excluding header) */
        .table-custom tbody tr:hover {
            background-color: #f1f3f5;
        }

        /* Table header styling */
        .table-custom thead tr {
            background-color: #f8f9fa;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            text-align: center;
            font-weight: bold;
        }

        /* Action button styling */
        .action-btn {
            border: none;
            background: none;
            cursor: pointer;
            margin-right: 5px;
        }

        .action-btn:hover {
            color: #007BFF;
        }




       /* Search bar styling */
       .filter-container {
        display: flex;
        flex-wrap: nowrap;
        align-items: center;
        gap: 10px;
        margin-left: -150px !important;
        padding-top: 6vh;
        width: 100%; /* Ensure the container takes the full width */
        }

        
        .filter-input {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .filter-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 8px rgba(0,123,255,.5);
        }

        .buttons-container {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 20px; /* Adjust the padding as needed */
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s;
            white-space: nowrap; /* Prevent text from wrapping */
            overflow: hidden; /* Prevent content from spilling out */
            text-overflow: ellipsis; /* Add an ellipsis if the text is too long to fit */
            min-width: 100px; /* Adjust as needed to fit your content */
            /* width: 150px; Uncomment and adjust if a fixed width is desired */
        }


        .btn-primary {
            background-color: #6699CC;
            color: white;
        }

        .btn-primary:hover {
            background-color: #5072A7;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #545b62;
        }


        /* Specificity increased by targeting the button with all its classes */
        .btn.btn-outline-dark.btn-sm {
            background-color: #0076CE !important; /* Overriding Bootstrap styles */
            color: white !important;
            border-color: #0076CE !important; /* Match the border color to the background */
        }

        /* Change hover styles */
        .btn.btn-outline-dark.btn-sm:hover {
            background-color: #5a8ebc !important; /* A darker shade for hover */
            border-color: #5a8ebc !important; /* Match the border color to the hover background */
        }

        /* Adjust disabled button if needed */
        .btn.btn-outline-dark.btn-sm:disabled {
            background-color: #a0b1c4 !important;
            border-color: #a0b1c4 !important;
            cursor: not-allowed !important;
        }

        .search-input {
            padding: 6px 10px; /* Increased padding for better appearance and usability */
            border: 2px solid #ddd; /* Subtle border */
            border-radius: 4px; /* Rounded corners */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
            font-size: 16px; /* Slightly larger font size for readability */
            transition: border-color 0.3s, box-shadow 0.3s; /* Smooth transition for focus */
        }
        
        .search-input::placeholder { /* Style the placeholder text */
            color: #999;
            opacity: 1; /* Full opacity placeholder text */
        }
        
        .search-input:focus {
            outline: none; /* Remove the default focus outline */
            border-color: #007bff; /* Highlighted border color when focused */
            box-shadow: 0 2px 5px rgba(0, 123, 255, 0.2); /* Enhanced shadow on focus */
        }
        
        /* Pagination styling */
        .table-wrapper {
            position: relative;
            padding-bottom: 70px;
        }

        .pagination {
            position: absolute;
            bottom: 10px;
            right: -230px;
            left: 0;
            justify-content: flex-end;
        }


        .pagination a {
            margin: 0 5px;
            padding: 5px 10px;
            border: 1px solid #6699CC;
            color: #6699CC;
            text-decoration: none;
            border-radius: 3px;
            transition: background-color 0.3s;
        }

        .pagination a:hover {
            background-color: #6699CC;
            color: white;
        }

        .pagination a.active {
            background-color: #6699CC;
            color: white;
        }
              /* Additional responsive styles */
            @media (max-width: 768px) {

            .table-custom {
                width: 100%;
                margin-left: 0;
            }

            .filter-container {
                flex-direction: column;
                align-items: stretch;
                margin-left: 0 !important;
            }

            .pagination {
                position: static;
                margin-top: 20px;
                justify-content: center;
            }
        }

            /* Custom Navbar Toggler Styles */
            .navbar-toggler {
                border: none;
                margin-right: auto;
            }

            .navbar-toggler-icon {
                display: inline-block;
                width: 30px;
                height: 30px;
                vertical-align: middle;
                background-image: none;
            }

            .navbar-toggler-icon:after,
            .navbar-toggler-icon:before,
            .navbar-toggler-icon div {
                content: '';
                display: block;
                height: 3px;
                margin: 5px 0;
                background-color: #fff; /* Change color if needed */
            }

            /* Center the logout button on smaller screens */
            @media (max-width: 992px) {
                .navbar-collapse .form-inline {
                    display: flex;
                    justify-content: center;
                    width: 100%;
                    margin-top: 10px;
                }
            }
        
    </style>
</head>

<body>


  
          <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg" style="background-color: #219ebc;">
        <!-- Navbar Toggler Button -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navbar content -->
        <div class="collapse navbar-collapse" id="navbarNav">             
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="/manager/dashboard">Dashboard - <span class="badge badge-secondary">
                            <%= dropPointName %>
                        </span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/manager/manageDonation">Manage Donations</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/manager/managerAccount">Account</a>
                </li>
            </ul>
            <form class="form-inline my-2 my-lg-0" method="post" action="/manager/logout">
                <button class="btn btn-logout my-2 my-sm-0" type="submit">LOGOUT</button>
            </form>
        </div>
    </nav>


    <div class="container">
  

        <div class="table-wrapper">
            <!-- Table to List Donations -->
            <table class="table-custom">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Organization</th>
                        <th scope="col">Expected Date of Arrival</th>
                        <th scope="col">Peripherals</th>
                        <th scope="col">Status</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
               
              
                <div class="filter-container">
                    <!-- Filter by Expected Date of Arrival -->
                    <input type="text" id="searchInput" class="search-input" placeholder="Search...">
                    <input type="date" id="filterDate" class="filter-input" placeholder="Filter by Date">
                
                    <!-- Filter by Status -->
                    <select id="filterStatus" class="filter-input">
                        <option value="">Select Status</option>
                        <option value="PENDING">Pending</option>
                        <option value="ARRIVED">Arrived</option>
                        <option value="VERIFIED">Verified</option> 
                        <option value="ACCEPTEDWITHISSUES">Accepted with Issues</option>
                    </select>
                
                    <!-- Date of Arrival Sorting -->
                    <select id="sortOrder" class="filter-input">
                        <option value="expectedDateOfArrival_asc">Date of Arrival (Ascending)</option>
                        <option value="expectedDateOfArrival_desc">Date of Arrival (Descending)</option>  
                    </select>
                
                    <!-- Buttons Container -->
                    <div class="buttons-container">
                        <button id="applyFilters" class="btn btn-primary">Apply Filters</button>
                        <button id="clearFilters" class="btn btn-secondary">Clear Filters</button>
                    </div>
                </div>
                
                



                <!-- Pagination -->
                <div class="pagination">
                    <a href="?page=1">&laquo;</a>
                    <% for(let i = 1; i <= totalPages; i++) { %>
                      <% if(i == 1 || i == totalPages || i == currentPage || i == currentPage - 1 || i == currentPage + 1) { %>
                        <a href="?page=<%= i %>" class="<%= currentPage === i ? 'active' : '' %>"><%= i %></a>
                      <% } else if(i == currentPage - 2 || i == currentPage + 2) { %>
                        <span>...</span>
                      <% } %>
                    <% } %>
                    <a href="?page=<%= totalPages %>">&raquo;</a>
                  </div>
                                   

        </div>

        <tbody>
            <% donations.forEach(function(donation, index) { %>

                <tr>
                    <td>
                        <%= index + 1 %>
                    </td>
                    <td>
                        <%= donation.organization.organizationname %>
                    </td>
                    <td>
                        <%= donation.expectedDateOfArrival ? new
                            Date(donation.expectedDateOfArrival).toLocaleDateString() : 'N/A' %>
                    </td>
                    <td>
                        <!-- Add a button to open a modal for peripherals -->
                        <button class="btn btn-primary btn-sm" type="button" data-toggle="modal"
                            data-target="#peripheralsModal<%= index %>">
                            View Peripherals
                        </button>
                        <!-- Modal for peripherals -->
                        <div class="modal fade" id="peripheralsModal<%= index %>" tabindex="-1" role="dialog"
                            aria-labelledby="peripheralsModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="peripheralsModalLabel">Peripherals for <%=
                                                donation.organization.organizationname %>
                                        </h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <% if (donation.peripherals) { %>
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>Type</th>
                                                            <th>Brand</th>
                                                            <th>Model</th>
                                                            <th>Condition</th>
                                                            <th>Quantity</th>
                                                            <th>Update</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <% donation.peripherals.forEach(function(peripheral, peripheralIndex) { %>
                                                        <form action="/manager/updatePeripheral" method="post">
                                                            <tr id="peripheralRow<%= peripheralIndex %>">
                                                                <td><%= peripheral.type %></td>
                                                                <td><%= peripheral.brand %></td>
                                                                <td><%= peripheral.model %></td>
                                                                <td>
                                                                    <select class="form-control" name="condition" id="condition<%= peripheralIndex %>">
                                                                        <option value="Used but Working" <%= peripheral.condition === "Used but Working" ? "selected" : "" %>>Used but Working</option>
                                                                        <option value="New" <%= peripheral.condition === "New" ? "selected" : "" %>>New</option>
                                                                    </select>
                                                                </td>
                                                                <td>
                                                                    <input type="number" class="form-control" name="quantity" value="<%= peripheral.quantity %>" id="quantity<%= peripheralIndex %>">
                                                                </td>
                                                                <td>
                                                                    <input type="hidden" name="peripheralId" value="<%= peripheral.id %>"> 
                                                                    <button type="submit" class="btn btn-primary btn-sm" <%= ['VERIFIED', 'ACCEPTEDWITHISSUES'].includes(donation.status) ? 'disabled' : '' %>>Update</button>
                                                                </td>
                                                            </tr>
                                                        </form>
                                                        <% }) %>
                                                    </tbody>
                                                </table>
                                        <% } else { %>
                                            <p>No peripherals available</p>
                                        <% } %>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </td>
                    <td>
                        <!-- Display different verification statuses -->
                        <% if (donation.status==='PENDING' ) { %>
                            <span class="badge badge-warning">
                                <%= donation.status %>
                            </span>
                            <% } else if (donation.status==='ARRIVED' ) { %>
                                <span class="badge badge-primary">
                                    <%= donation.status %>
                                </span>
                                <% } else if (donation.status==='VERIFIED' ) { %>
                                    <span class="badge badge-success">
                                        <%= donation.status %>
                                    </span> 
                                        <% } else if (donation.status==='ACCEPTEDWITHISSUES' ) { %>
                                            <span class="badge badge-info">
                                                <%= donation.status %>
                                            </span>
                                            <% } %>

                    </td>
                    <td>
                        <!-- Button to open a modal for status update -->
                        <button class="btn btn-outline-dark btn-sm" type="button" data-toggle="modal"
                            data-target="#statusModal<%= index %>">
                            Update Status
                        </button>
                        <!-- Modal for status update -->
                        <div class="modal fade" id="statusModal<%= index %>" tabindex="-1" role="dialog"
                            aria-labelledby="statusModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="statusModalLabel">Update Donation Status</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <!-- Status update form -->
                                        <form action="/manager/updateDonationStatus" method="post">
                                            <!-- Hidden input for the donation ID -->
                                            <input type="hidden" name="donationId" value="<%= donation.id %>">
                                            <div class="form-group">
                                                <label for="newStatus">Select New Status:</label> 
                                                <select class="form-control" id="newStatus" name="newStatus" <%= ['VERIFIED', 'ACCEPTEDWITHISSUES'].includes(donation.status) ? 'disabled' : '' %>>

                                                    <option disabled readonly selected>Select Status</option>
                                                    <option value="ARRIVED">Arrived</option>
                                                    <option value="VERIFIED">Verified</option> 
                                                    <option value="ACCEPTEDWITHISSUES">Accepted with Issues</option>
                                                </select>
                                            </div> 
                                            <button type="submit" class="btn btn-primary" <%= ['VERIFIED', 'ACCEPTEDWITHISSUES'].includes(donation.status) ? 'disabled' : '' %>>Update Status</button>
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary"
                                            data-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                <% }) %>
        </tbody>
        </table>

    </div>

    <!-- Load Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchQuery = e.target.value;
            window.location.href = `/manager/manageDonation?search=${searchQuery}`;
        });

        document.getElementById('applyFilters').addEventListener('click', function() {
            const filterDate = document.getElementById('filterDate').value;
            const filterStatus = document.getElementById('filterStatus').value;
            const sortOrder = document.getElementById('sortOrder').value;
            let query = '/manager/manageDonation?';

            if (filterDate) {
                query += `date=${filterDate}&`;
            }
            if (filterStatus) {
                query += `status=${filterStatus}&`;
            }
            if (sortOrder) {
                query += `sort=${sortOrder}`;
            }

            window.location.href = query;
        });

        document.getElementById('clearFilters').addEventListener('click', function() {
            window.location.href = '/manager/manageDonation';
        });


    </script>

</body>

</html>