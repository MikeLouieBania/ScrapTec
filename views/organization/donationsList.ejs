<!DOCTYPE html>
<html>
    <head>
      <title>My Account</title>
      <!-- Link to Bootstrap CSS -->
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>
      <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
      <style>
        /* Additional custom styles for the page */
        body {
          font-family: 'Poppins', sans-serif;
        }
        .container {
          max-width: 800px;
          margin: 0 auto;
          padding: 20px;
        }

        /* Navigation Bar Styles */
        .navbar.navbar-expand-lg.navbar-light.bg-light {
          background-color: #219ebc !important;
          padding: 10px 0;
        }


        .nav-link {
          color: white !important;
          font-family: 'Roboto Slab', serif,;
          font-size: 16px;
          margin-top: 15px;
        }

        .navbar-brand {
          color: white !important;
          font-family: 'Roboto Slab', serif,;
          font-weight: bold;
          font-size: 16px;
          margin-top: 1px; /* Align with .nav-link */
          margin-left: 15px;
        }

        .navbar-light .navbar-toggler-icon {
          background-color: #219ebc;
        }

        /* Custom Logout Button Style */
        .btn-outline-success {
          background-color: #002244 !important;
          border: none;
          padding: 10px 20px;
          border-radius: 5px;
          transition: background-color 0.3s;
          margin-right: 20px;
          font-weight: bold;
          color: white !important;
          font-family: 'Roboto Slab', serif,;
        }

        .btn-outline-success:hover {
          background-color: #6082B6 !important;
          color: #fff !important;
          text-decoration: none;
        }

        /* Body */
        body {
          padding-top: 0px;
          margin-bottom: 60px;
        }

        /* Additional Styles for Navigation Links */
        .nav-link {
          display: block;
          padding: 15px;
          text-decoration: none;
          color: white !important;
          font-weight: bold;
          text-transform: uppercase;
          margin: 0 10px;
          position: relative;
          transition: all .5s;
        }


        .nav-link::after {
          content: "";
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          height: 2px;
          background-color: #8ecae6;
          transform: scaleX(0);
          transition: transform 0.5s;
        }

        .nav-link:hover::after {
          transform: scaleX(1);
        }

        /* Container Styling */
        .mt-5 {
          margin-top: 2rem; /* Adjusted margin for better spacing */
          display: flex;
        }

        /* Table Styling */
        .table {
          width: 150%;
          margin-bottom: 1rem;
          color: #212529;
          margin-left: -20%;
        }

        .table-responsive .table {
          width: 100%; /* Adjust based on your needs */
          margin-bottom: 1rem;
          color: #212529;
          margin-left: auto;
          margin-right: auto;
        }
        
        
        
        /* Table Header Styling */
        .table thead th {
          vertical-align: bottom;
          border-bottom: 2px solid #dee2e6;
          background-color: #f8f9fa;
          padding: 1rem;
          text-align: center;
          font-weight: bold;
          color: #495057; /* Dark grey color for better contrast */
        }

        /* Table Body Styling */
        .table tbody tr {
          transition: background-color 0.3s ease;
        }

        .table tbody tr:hover {
          background-color: #f1f3f5; /* Light grey background on row hover */
        }

        .table tbody td {
          padding: 1rem;
          border-top: 1px solid #dee2e6;
          vertical-align: top;
        }

        /* Action Buttons or Links in the Table */
        .table tbody td a,
        .table tbody td button {
          padding: 0.375rem 0.75rem;
          margin-right: 0.5rem; /* Space between buttons or links */
          text-align: center;
          border: 1px solid transparent;
          border-radius: 0.25rem;
          font-size: 1rem;
          line-height: 1.5;
          transition: all 0.3s ease;
        }

        .table tbody td a:hover,
        .table tbody td button:hover {
          text-decoration: none;
          opacity: 0.8;
        }

        /* Specific Styles for Different Statuses (if applicable) */
        .table tbody tr td.status-completed {
          color: #28a745; /* Bootstrap success color */
        }

        .table tbody tr td.status-pending {
          color: #ffc107; /* Bootstrap warning color */
        }

        .table tbody tr td.status-cancelled {
          color: #dc3545; /* Bootstrap danger color */
        }

            /* Small devices (landscape phones, 576px and up) */
        @media (max-width: 576px) { 
          .navbar-brand, .nav-link {
              font-size: 14px;
              margin-top: 0; /* Adjust alignment */
          }

          .btn-outline-success, .btn-primary {
              padding: 8px 15px;
              font-size: 14px;
          }

          .container {
              width: 95%;
              padding: 15px;
          }

          .form-control, .form-control-static {
              font-size: 13px; /* Smaller font size for form elements */
          }

          .nav-link {
              padding: 10px; /* Reduced padding */
              font-size: 14px; /* Smaller font size */
          }
        }

        /* Medium devices (tablets, 768px and up) */
        @media (max-width: 768px) {
          .navbar-brand, .nav-link {
              font-size: 15px;
          }

          .btn-outline-success, .btn-primary {
              padding: 9px 18px;
              font-size: 15px;
          }

          .container {
              width: 90%;
              padding: 18px;
          }

          .form-control, .form-control-static {
              font-size: 14px;
          }

          .nav-link {
              padding: 12px;
              font-size: 15px;
          }
        }

        /* Large devices (desktops, 992px and up) */
        @media (min-width: 992px) {
          /* Styles for larger screens can remain as they are */
          .container {
              max-width: 800px; /* Ensuring the container doesn't get too wide on large screens */
          }
        }
      </style>
    </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="/organization/dashboard">DASHBOARD</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav mr-auto">  
                <li class="nav-item">
                <a class="nav-link" href="/organization/donationsList">Donations</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="/organization/pledgeBasket">Pledge Basket</a>
                </li>  
                <li class="nav-item">
                <a class="nav-link" href="/organization/faq">FAQ</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="/organization/account">Account</a>
                </li>
            </ul> 
            <form class="form-inline my-2 my-lg-0" method="post" action="/organization/logout">
                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">LOGOUT</button>
            </form>
        </div>
    </nav>

    <div class="container">    
      
      <!-- Donations Table -->
      <div class="mt-5">
        <h3>My Donations</h3>
        <table class="table table-bordered">
          <thead>
            <tr> 
              <th scope="col">Status</th>
              <th scope="col">Drop Point</th>
              <th scope="col">Scheduled Drop-off Date</th>
              <th scope="col">Total Points</th>
              <th scope="col" colspan="2">Action</th>
            </tr>
          </thead>
          <tbody>
            <% donations.forEach(donation => { %>
              <tr> 
                <td><%= donation.status %></td>
                <td><%= donation.dropPoint.name %></td>
                <td><%= donation.expectedDateOfArrival ? new Date(donation.expectedDateOfArrival).toLocaleDateString() : 'N/A' %></td>
                <td>
                  <% if (donation.status === 'PENDING' || donation.status === 'ARRIVED') { %>
                    <span class="text-warning"><%= donation.points ? donation.points + " (Attainable)" : "N/A" %></span> 
                  <% } else if (donation.status === 'VERIFIED' || donation.status === 'ACCEPTEDWITHISSUES') { %>
                    <span class="text-success"><%= donation.points ? donation.points : "N/A" %></span>
                  <% } %>
                </td>
                
                <td><button class="btn btn-info btn-sm" data-toggle="collapse" data-target="#donation-<%= donation.id %>">Toggle Details</button></td>
                <td> 
                  <% if (!["VERIFIED", "ARRIVED", "ACCEPTEDWITHISSUES"].includes(donation.status)) { %>
                    <!-- Show Cancel Button if status is not one of the specified ones -->
                    <button class="btn btn-danger btn-sm" data-toggle="modal" data-target="#cancelDonationModal-<%= donation.id %>">Cancel</button>
                  <% } else { %>
                    <span class="text-muted">No actions available</span> 
                  <% } %>
                </td>                
              </tr>
              <!-- Collapsible Row for Donation Details -->
              <tr id="donation-<%= donation.id %>" class="collapse">
                <td colspan="5">
                    <h5>Peripherals:</h5> 
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead class="thead-light">
                                <tr>
                                    <th>Type</th>
                                    <th>Brand</th>
                                    <th>Model</th>
                                    <th>Condition</th>
                                    <th>Quantity</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% donation.peripherals.forEach(peripheral => { %>
                                    <tr>
                                        <td><%= peripheral.type %></td>
                                        <td><%= peripheral.brand %></td>
                                        <td><%= peripheral.model %></td>
                                        <td><%= peripheral.condition %></td>
                                        <td><%= peripheral.quantity %></td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                </td>
              </tr> 
              <!-- Modal -->
              <div class="modal fade" id="cancelDonationModal-<%= donation.id %>" tabindex="-1" role="dialog" aria-labelledby="cancelDonationModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="cancelDonationModalLabel">Cancel Donation</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <p>Are you sure you want to cancel this donation? Forfeiture of the donation will remove all your inputs.</p>
                    </div>
                    <!-- Inside the modal in your HTML page -->
                    <form action="/organization/cancelDonation/<%= donation.id %>" method="post">
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-danger">Cancel Donation</button>
                      </div>
                    </form> 
                  </div>
                </div>
              </div>

            <% }); %>
          </tbody>
        </table>
      </div>
    </div>



    <!-- Load Bootstrap JS (you can also include jQuery for additional functionality) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </body>
</html>
